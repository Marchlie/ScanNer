#!/usr/bin/python3
# -*- coding: UTF-8 -*-
#
# Author: Marchlie
# Date: 2022-03-24
# Link: github.com/marchlie/scanner

"""
Vulnerability identification
"""

import nmap
from tools import *
from scapy.layers.inet import IP, TCP, sr1


def vulnerability(scanInfo):
    """
    vulnerability identification
    """
    # Set target IP
    targetIP = scanInfo["targetIP"]
    # Set target port
    targetPort = scanInfo["targetPort"]
    # Set debug mode
    isDebug = scanInfo["isDebug"]
    # Set portlist
    portlist = scanInfo["portlist"]
    # Set fingerprint
    fingerprint = scanInfo["fingerprint"]
    # Set timeout
    timeout = 3
    # Set vulnerability
    vulnerability = None
    for fingerprint in fingerprint:
        # Set port
        port = fingerprint["port"]
        # Set service
        service = fingerprint["service"]
        # Set banner
        banner = fingerprint["banner"]
        # Set vulnerability
        vulnerability = None
        # If port is not in portlist, skip
        if port not in portlist:
            continue
        # If service is not in portlist, skip
        if service not in portlist[port]:
            continue
        # If banner is not in portlist, skip
        if banner not in portlist[port][service]:
            continue
        # If banner is not in portlist, skip
        if "vulnerability" not in portlist[port][service][banner]:
            continue
        # Set vulnerability
        vulnerability = portlist[port][service][banner]["vulnerability"]
        # If vulnerability is not None, break
        if vulnerability != None:
            break



if __name__ == "__main__":
    notMain()
